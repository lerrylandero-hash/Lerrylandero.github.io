<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InNova - Seguridad Digital</title>
    <!-- Incluyendo el framework Tailwind CSS para un diseño moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluyendo Google Fonts para la fuente "Inter" -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out;
        }
        .btn {
            background-color: #2563eb;
            color: white;
            padding: 12px 24px;
            border-radius: 9999px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .loading::after {
            content: '';
            width: 30px;
            height: 30px;
            border: 4px solid #d1d5db;
            border-top-color: #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div class="container mx-auto max-w-2xl text-center">
        <header class="mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4">InNova: Test de Seguridad Digital</h1>
            <p class="text-lg md:text-xl text-gray-600">
                Responde las preguntas para evaluar tus conocimientos sobre cómo navegar de forma segura.
            </p>
        </header>

        <main class="card p-8">
            <div id="welcomeScreen">
                <p class="text-lg mb-6 text-gray-700">¡Hola! ¿Estás listo para poner a prueba tus habilidades de seguridad en Internet? Presiona "Comenzar" para iniciar el test. Te haré una serie de preguntas sobre temas importantes.</p>
                <button id="startBtn" class="btn">Comenzar Test</button>
            </div>

            <div id="testScreen" class="hidden">
                <div class="mb-6">
                    <p id="questionText" class="text-xl font-semibold text-gray-800 mb-4"></p>
                    <textarea id="userAnswer" class="w-full h-32 p-4 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Escribe tu respuesta aquí..."></textarea>
                </div>
                <div class="flex justify-between">
                    <button id="sendBtn" class="btn">Enviar Respuesta</button>
                    <button id="nextBtn" class="btn hidden">Siguiente Pregunta</button>
                </div>
            </div>

            <div id="resultScreen" class="hidden">
                <h2 class="text-2xl font-bold mb-4 text-blue-700">Análisis de tu respuesta:</h2>
                <div id="resultContent" class="text-left text-gray-700 leading-relaxed"></div>
                <button id="restartBtn" class="btn mt-8">Volver a Empezar</button>
            </div>
            
            <div id="loadingIndicator" class="hidden mt-8">
                <div class="loading"></div>
                <p class="text-center text-gray-500 mt-4">Analizando tu respuesta...</p>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Referencias a elementos del DOM
            const welcomeScreen = document.getElementById('welcomeScreen');
            const testScreen = document.getElementById('testScreen');
            const resultScreen = document.getElementById('resultScreen');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const startBtn = document.getElementById('startBtn');
            const sendBtn = document.getElementById('sendBtn');
            const restartBtn = document.getElementById('restartBtn');
            const questionText = document.getElementById('questionText');
            const userAnswer = document.getElementById('userAnswer');
            const resultContent = document.getElementById('resultContent');

            // URL y clave de la API de Google Gemini (se deja en blanco para que la plataforma la complete)
            const API_KEY = "TU_CLAVE_DE_API_AQUI";
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            
            let currentQuestionIndex = 0;
            const questions = [
                "¿Qué es el 'phishing' y cómo puedes identificar un correo electrónico sospechoso?",
                "Si un amigo te envía un enlace para ganar un premio, ¿qué pasos de seguridad debes seguir antes de hacer clic?",
                "¿Por qué es importante usar contraseñas fuertes y únicas para cada una de tus cuentas?",
                "¿Qué es el ciberacoso y cómo deberías reaccionar si lo experimentas o lo presencias?",
                "¿Cómo puedes saber si una noticia que ves en redes sociales es falsa?",
            ];

            const showMessage = (message, isError = false) => {
                const messageBox = document.createElement('div');
                messageBox.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 ${isError ? 'bg-red-500 text-white' : 'bg-gray-800 text-white'}`;
                messageBox.textContent = message;
                document.body.appendChild(messageBox);
                setTimeout(() => { messageBox.remove(); }, 5000);
            };

            const displayQuestion = () => {
                if (currentQuestionIndex < questions.length) {
                    questionText.textContent = questions[currentQuestionIndex];
                    userAnswer.value = '';
                    testScreen.classList.remove('hidden');
                    welcomeScreen.classList.add('hidden');
                    resultScreen.classList.add('hidden');
                } else {
                    showMessage("¡Has completado el test! ¡Excelente trabajo!", false);
                    testScreen.classList.add('hidden');
                    restartBtn.classList.remove('hidden');
                    resultContent.innerHTML = "¡Has completado todas las preguntas! Presiona el botón para volver a empezar.";
                    resultScreen.classList.remove('hidden');
                }
            };

            const analyzeAnswer = async () => {
                const userResponse = userAnswer.value.trim();
                if (userResponse === "") {
                    showMessage("Por favor, escribe tu respuesta para continuar.", true);
                    return;
                }

                loadingIndicator.classList.remove('hidden');
                sendBtn.disabled = true;

                try {
                    const prompt = `Actúa como un tutor experto en ciberseguridad para adolescentes. Analiza la siguiente respuesta a la pregunta: "${questions[currentQuestionIndex]}". La respuesta del usuario es: "${userResponse}". Proporciona una explicación detallada en español que incluya: 1) Una retroalimentación sobre la respuesta, 2) Información adicional para profundizar, y 3) Un consejo práctico para aplicar en la vida real. Responde de forma amigable y útil.`;
                    
                    const payload = {
                        contents: [{ parts: [{ text: prompt }] }],
                    };

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload),
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`Error de la API: ${JSON.stringify(errorData)}`);
                    }

                    const data = await response.json();
                    
                    if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0].text) {
                        const analysis = data.candidates[0].content.parts[0].text;
                        resultContent.innerHTML = analysis.replace(/\n/g, '<br>');
                        
                        testScreen.classList.add('hidden');
                        resultScreen.classList.remove('hidden');
                        currentQuestionIndex++;
                    } else {
                        showMessage("No se pudo analizar la respuesta. Intenta de nuevo.", true);
                    }

                } catch (error) {
                    console.error("Error al analizar la respuesta:", error);
                    showMessage("Ocurrió un error. Revisa la consola para más detalles.", true);
                } finally {
                    loadingIndicator.classList.add('hidden');
                    sendBtn.disabled = false;
                }
            };

            // Asignar eventos a los botones
            startBtn.addEventListener('click', displayQuestion);
            sendBtn.addEventListener('click', analyzeAnswer);
            restartBtn.addEventListener('click', () => {
                currentQuestionIndex = 0;
                welcomeScreen.classList.remove('hidden');
                resultScreen.classList.add('hidden');
            });
        });
    </script>
</body>
</html>
